<html>
  <head>
    <title>Matrix Diagram</title>
    <script type="text/javascript" src="js/protovis.js"></script>
    <script type="text/javascript">
    //PETICIO DUMMY
	    var matrix ={
	    		   "matrix": [
	    		       {
	    		           "dst": "10.0.0.4",
	    		           "src": "10.0.0.1",
	    		           "traffic": 12500000
	    		       },
	    		       {
	    		           "dst": "10.0.0.3",
	    		           "src": "10.0.0.2",
	    		           "traffic": 6250000
	    		       },
	    		       {
	    		           "dst": "10.0.0.2",
	    		           "src": "10.0.0.3",
	    		           "traffic": 3125000
	    		       },
	    		       {
	    		           "dst": "10.0.0.1",
	    		           "src": "10.0.0.4",
	    		           "traffic": 9000000
	    		       }
	    		   ]
	    		};
	    		var nodes=[];
	    		var links=[];
	    		var pushSrc=true;
	    		var pushDst=true;

	    		//alert(matrix.matrix.length);
	    		for (var i=0; i<matrix.matrix.length;i++){
					for(var j=0; j<nodes.length;j++){
						if(matrix.matrix[i].src==nodes[j].name){
							pushSrc=false;	
						}
					}
					
					if (pushSrc){
		    			nodes.push({"name":matrix.matrix[i].src});
		    			pushSrc=true;
					}

					//alert(nodes[0].name);
					for(var j=0; j<nodes.length;j++){
						if(matrix.matrix[i].dst==nodes[j].name){
							pushDst=false;	
						}
					}
	    			
					if (pushDst){
		    			nodes.push({"name":matrix.matrix[i].dst});
		    			pushDst=true;
					}
	    		}

		    	sorting(nodes,'name');
	    		for (var i=0; i<matrix.matrix.length;i++){
					for(var j=0;j<nodes.length;j++){
						if (matrix.matrix[i].src==nodes[j].name){
							var src = j;
	    				}
	    				if(matrix.matrix[i].dst==nodes[j].name){
	    					var dst = j;
	    				}
	    			}
	    			
					links.push({"source":src,"target":dst,"value":matrix.matrix[i].traffic});
	    			
	    		}



		    	

	    		function getGreenToRed(percent){
	    	        g = percent<50 ? 255 : Math.floor(255-(percent*2-100)*255/100);
	    	        r = percent>50 ? 255 : Math.floor((percent*2)*255/100);
	    	        //var col = "#"+r+""+g+"0";
	    	        //alert(col);
	    	        return 'rgb('+r+','+g+',0)';
	    	    }
	    	    
		    	function sorting(json_object, key_to_sort_by) {
		    	    function sortByKey(a, b) {
		    	        var x = a[key_to_sort_by];
		    	        var y = b[key_to_sort_by];
		    	        return ((x < y) ? -1 : ((x > y) ? 1 : 0));
		    	    }

		    	    json_object.sort(sortByKey);
		    	}

    </script>
  </head>
  <body><div id="center"><div id="fig">
    <script type="text/javascript+protovis">




var color = pv.Colors.category19().by(function(d) d.group);

var vis = new pv.Panel()
    .width(500)
    .height(500)
    .top(90)
    .left(90);

var layout = vis.add(pv.Layout.Matrix)
    .nodes(nodes)
	.directed(true)
    .links(links)
	.sort(function(a, b) {return b.name});
    //.sort(function(a, b) {alert(b.name);return b.group - a.group});

layout.link.add(pv.Bar)
	.fillStyle(function(l){ return getGreenToRed(l.linkValue*8/1000000)})
    .antialias(false)
    .lineWidth(8);

layout.label.add(pv.Label)
    .textStyle(color)
	.text(function(d)	{return d.name});

vis.render();

    </script>
  </div></div></body>
</html>